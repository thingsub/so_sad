<!-- <!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈</title>
    <script>
        window.onload = async function() {
            // 1. localStorage에서 토큰 가져오기
            const accessToken = localStorage.getItem('token');
            
            // 2. 토큰이 없으면 로그인 페이지로 이동
            if (!accessToken) {
                alert("토큰이 없습니다. 로그인 페이지로 이동합니다.");
                window.location.href = '/login';
                return;
            }

            // 3. 토큰이 있는 경우 서버로 API 요청
            try {
                const response = await fetch('/home', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                // 4. 서버 응답 확인
                if (response.ok) {
                    const data = await response.json();
                    console.log('홈 페이지 로드 성공:', data);
                    document.getElementById('userId').textContent = data.userId;
                } else if (response.status === 401) {
                    alert('인증되지 않았습니다. 로그인 페이지로 이동합니다.');
                    window.location.href = '/login';
                } else {
                    alert(`서버 오류가 발생했습니다: ${response.status}`);
                }

            } catch (error) {
                console.error('네트워크 오류 또는 서버가 응답하지 않습니다:', error);
                alert('서버와의 연결이 원활하지 않습니다.');
            }
        };
    </script>
</head>
<body>
    <h2>환영합니다, <span id="userId"></span>님!</h2>
</body>
</html> -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈</title>
</head>
<body>
    <h2>환영합니다, <span id="userId"></span>님!</h2>
    <button onclick="handleLogout()">로그아웃</button>
    <script>
        window.onload = async function() {
            const accessToken = localStorage.getItem('token');
            
            if (!accessToken) {
                alert("토큰이 없습니다. 로그인 페이지로 이동합니다.");
                window.location.href = '/login';
                return;
            }
    
            try {
                const response = await fetch('/home', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    }
                });
    
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('userId').textContent = data.userId;
                } else if (response.status === 401) {
                    alert('인증되지 않았습니다. 로그인 페이지로 이동합니다.');
                    localStorage.removeItem('token'); // 토큰 삭제
                    window.location.href = '/login'; // 로그인 페이지로 이동
                }
    
            } catch (error) {
                console.error('서버와의 연결 오류:', error);
                alert('서버와의 연결이 원활하지 않습니다.');
            }
        };
    </script>
</body>
</html>
